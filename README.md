# ML Service Practicum — Module 3 (Task #4)

Учебный проект в рамках практикума по разработке ML сервисов на Python.

В качестве учебного проекта выбран ML сервис по предсказанию биологического возраста и факторов, влияющих на него. Расчет (предсказание) осуществляется на основании входных данных по биомаркерам. 
На текущем этапе используется mock-ML модель с возможностью последующего расширения.

---

## Что реализовано по **Заданию #5** Урок 5: Способы взаимодействия с ML сервисами:

- Реализовано асинхронное взаимодействие по модели **publisher → RabbitMQ → consumers**:
  - Используется одна очередь RabbitMQ (ml_tasks)
  - Реализованы несколько ML-воркеров (2 consumers):
    **worker-1**
    **worker-2**
- Воркеры:
  - получают ML-задачи из очереди;
  - валидируют входные данные;
  - выполняют ML-предикт (mock-модель);
  - сохраняют результат обработки в PostgreSQL.

## Что реализовано по **Заданию #4** Урок 4: Способы взаимодействия с пользователем:

- Реализован **REST-интерфейс** на **FastAPI**, покрывающий весь базовый функционал системы.
  - Регистрация и авторизация
  - Просмотр и пополнение баланса
  - Отправка запроса на выполнение предсказания биологического возраста
  - Просмотр истории запросов
- **Эндпоинты**:
  - POST /api/auth/register — регистрация
  - POST /api/auth/login — авторизация
  - GET /api/wallet — просмотр баланса
  - POST /api/wallet/topup — пополнение баланса
  - POST /api/tasks/predict — создать ML-задачу и отправить в RabbitMQ
  - GET /api/tasks/history — история задач пользователя
  - POST /api/tasks — создание задачи (черновик)
  - POST /api/tasks/{task_id}/run — запуск ранее созданной задачи
  Код API структурирован и разделён на routes (эндпоинты) и schemas (контракты запросов и ответов). 

## Что реализовано по **Заданию #3** Урок 3: Хранение данных:

- Интегрирована **PostgreSQL** в качестве базы данных
- Подключена **ORM SQLAlchemy** для работы с БД:
  - Откорректированны модели данных (User, Wallet, Transaction, Assessment, MLModel)
  - Реализованы связи между сущностями 
- Реализован **сценарий инициализации БД** (`init_db.py`): 
- **Протестирована работоспособность через демо сценарий** (`main.py`):
  - Создание демо-пользователtq и администратора
  - Пополнение баланса и списание кредитов
  - История транзакций 

## Что реализовано по **Заданию #2** Урок 2: Запуск и эксплуатация сервиса. Часть 1:

- Организована структура проекта с разделением на модули (`models`, `ml`, `services`)
- Создан **docker-compose.yaml** с 4 сервисами:
  - **app** — основное приложение (конфигурация через `.env`, подключение через volumes)
  - **web-proxy** — Nginx (зависит от app, порты 80 и 443)
  - **rabbitmq** — брокер сообщений (порты 5672 и 15672, примонтирован volume к /var/lib/rabbitmq для сохранения очередей)
  - **database** — PostgreSQL (примонтирован volume к каталогу данных PostgreSQL для сохранения базы при удалении контейнера)
- Добавлен **Dockerfile** для контейнеризации приложения


## Что реализовано по **Заданию #1** Урок 1: Конструирование ПО:

- **все доменные сущности + use-case сервисы** находятся в одном файле: `app/models.py`  
- хранилище данных — **in-memory** (класс `Repository`)  
- ML часть представлена **контрактами (ABC) + заглушкой предиктора**, чтобы показать расширяемость

---

## Структура проекта
```
ml-biological-age-service/
├── app/
│   ├── database/                   
│   ├── ml/                    # ML модели, предикторы, валидаторы
│   ├── models/                # Доменные сущности
│   ├── mq/                    # Publisher
│   ├── routes/
│   ├── schemas/  
│   ├── services/              # Бизнес-логика
│   │   ├── crud/              # CRUD операции с БД
│   │   ├── admin.py
│   │   ├── auth.py
│   │   ├── billing.py
│   │   └── task.py
│   ├── api.py
│   ├── main.py                # Демо-сценарий 3-его задания
│   ├── .env.template
│   ├── Dockerfile
│   └── requirements.txt
├── worker/                     # ML воркеры
├── nginx/
├── .gitignore
├── docker-compose.yaml
└── README.md

```

---

## Запуск через Docker Compose
```bash
docker compose up --build
```

---

## ML данные (в будущем)

Для следующих этапов планируется использовать датасет Kaggle:
https://www.kaggle.com/competitions/precision-health-predicting-human-age-with-biomark/data »

На данном этапе используется заглушка ML-предиктора.
